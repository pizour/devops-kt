#!/bin/bash
# PostgreSQL Backup Script - Generated by Ansible
# Server: {{ hostname }}

BACKUP_DIR="{{ backup_destination | default('/var/backups/postgresql') }}"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
RETENTION_DAYS={{ backup_retention_days | default(7) }}

# Create backup
pg_dumpall -U postgres | gzip > "${BACKUP_DIR}/backup_${TIMESTAMP}.sql.gz"

# Clean old backups
find "${BACKUP_DIR}" -name "backup_*.sql.gz" -mtime +${RETENTION_DAYS} -delete

echo "Backup completed: backup_${TIMESTAMP}.sql.gz"
