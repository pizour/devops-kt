# PostgreSQL configuration - Generated by Ansible
# Configuration for {{ hostname }}

listen_addresses = '*'
port = {{ database_port | default(5432) }}
max_connections = {{ max_connections | default(100) }}

# Memory settings based on host resources
shared_buffers = {{ (memory_limit | regex_replace('GB', '') | int * 256) if memory_limit is defined else 128 }}MB
effective_cache_size = {{ (memory_limit | regex_replace('GB', '') | int * 512) if memory_limit is defined else 512 }}MB

# Logging
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# Replication settings
{% if database_role == 'primary' %}
wal_level = replica
max_wal_senders = 3
wal_keep_size = 64
{% endif %}

# Region-specific settings
timezone = '{{ timezone | default("UTC") }}'
